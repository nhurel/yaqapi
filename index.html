<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Yaqapi by nhurel</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Yaqapi</h1>
        <p></p>

        <p class="view"><a href="https://github.com/nhurel/yaqapi">View the Project on GitHub <small>nhurel/yaqapi</small></a></p>


        <ul>
          <li><a href="https://github.com/nhurel/yaqapi/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/nhurel/yaqapi/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/nhurel/yaqapi">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="introduction" class="anchor" href="#introduction"><span class="octicon octicon-link"></span></a>Introduction</h1>

<p>YAQ API is Yet Another Query API. It takes the typesafety from torpedo query project and the 
fluent syntax from jooq to provide the best Hibernate Query DSL. YAQ API main advantages are :</p>

<ul>
<li>Typesafety</li>
<li>Easy to use API through its DSL</li>
<li>No class generation needed, no specific annotation nor any other tricky stuff</li>
<li>Fluent query writing</li>
<li>
<strong>No more StringBuilders</strong> <img class="emoji" title=":stuck_out_tongue:" alt=":stuck_out_tongue:" src="https://github.global.ssl.fastly.net/images/icons/emoji/stuck_out_tongue.png" height="20" width="20" align="absmiddle">
</li>
</ul><h1>
<a name="setup" class="anchor" href="#setup"><span class="octicon octicon-link"></span></a>Setup</h1>

<p>YAQ API is as easy to install as just including a jar in your classpath. </p>

<h2>
<a name="maven-support" class="anchor" href="#maven-support"><span class="octicon octicon-link"></span></a>Maven support</h2>

<p>Even if YAQ API is not yet available on a maven central repository, you can easily reference it in 
your pom.xml with the system scope :</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>me.hurel.hqlbuilder<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>yaqapi<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>system<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;systemPath&gt;</span>${project.basedir}/src/main/webapp/WEB-INF/lib/yaqapi-1.0.0.jar<span class="nt">&lt;/systemPath&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>

<h1>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h1>

<h2>
<a name="static-import" class="anchor" href="#static-import"><span class="octicon octicon-link"></span></a>Static import</h2>

<p>The most convenient way to use YAQ API is to make a static import of the Yaqapi class :</p>

<div class="highlight highlight-java"><pre><span class="kn">import</span> <span class="nn">static</span> <span class="n">me</span><span class="o">.</span><span class="na">hurel</span><span class="o">.</span><span class="na">hqlbuilder</span><span class="o">.</span><span class="na">builder</span><span class="o">.</span><span class="na">Yaqapi</span><span class="o">.*;</span>
</pre></div>

<h2>
<a name="write-your-query" class="anchor" href="#write-your-query"><span class="octicon octicon-link"></span></a>Write your query</h2>

<p>The first thing to do before writing your query is to create a proxy object on the entity you want to query.
This is simply done with the <em>queryOn</em> static method: </p>

<div class="highlight highlight-java"><pre><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">queryOn</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">());</span>
</pre></div>

<p>Then, simply write your query, starting with the select method and let you drive by the DSL :</p>

<div class="highlight highlight-java"><pre><span class="n">QueryBuilder</span> <span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="o">(</span><span class="n">user</span><span class="o">).</span><span class="na">from</span><span class="o">(</span><span class="n">user</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getAge</span><span class="o">()).</span><span class="na">isGreaterThan</span><span class="o">(</span><span class="mi">18</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">orderBy</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getLastName</span><span class="o">());</span>
</pre></div>

<p><strong>Tip</strong> : Use <code>selectFrom(user)</code> method as a shorthand for <code>select(user).from(user)</code></p>

<p>Finally, just build you query :</p>

<div class="highlight highlight-java"><pre><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">adults</span> <span class="o">=</span>  <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;)</span><span class="n">query</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">sessionFactory</span><span class="o">.</span><span class="na">createSession</span><span class="o">()).</span><span class="na">list</span><span class="o">();</span>
</pre></div>

<p>And that's it ! </p>

<p>You can put it all together :</p>

<div class="highlight highlight-java"><pre><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">queryOn</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">());</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">adults</span> <span class="o">=</span> <span class="n">selectFrom</span><span class="o">(</span><span class="n">user</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getAge</span><span class="o">()).</span><span class="na">isGreaterThan</span><span class="o">(</span><span class="mi">18</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">orderBy</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getLastName</span><span class="o">())</span>
                        <span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">sessionFactory</span><span class="o">.</span><span class="na">createSession</span><span class="o">()).</span><span class="na">list</span><span class="o">();</span>
</pre></div>

<h1>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h1>

<p>YAQ API currently supports :</p>

<ul>
<li>aliases in select clause</li>
<li>joins (inner and outer, specifying fetch)</li>
<li>cross joins</li>
<li>exists clause</li>
<li>group by... having clause</li>
<li>case when... then... else... end syntax</li>
<li>collections property (see the dollar function)</li>
<li>count, min, max, sum, avg functions</li>
<li>YAQ API declares parameters using the JPQL syntax and sets automatically the parameters</li>
</ul><h1>
<a name="-function" class="anchor" href="#-function"><span class="octicon octicon-link"></span></a>$ function</h1>

<p>The dollar function is a convenient way to query on properties of a collection property. 
See example below to understand :</p>

<div class="highlight highlight-java"><pre><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">queryOn</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">());</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">parents</span> <span class="o">=</span> <span class="n">select</span><span class="o">(</span><span class="n">user</span><span class="o">).</span><span class="na">from</span><span class="o">(</span><span class="n">user</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">innerJoin</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getChildren</span><span class="o">())</span>
                            <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">$</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getChildren</span><span class="o">()).</span><span class="na">getAge</span><span class="o">()).</span><span class="na">isLessThan</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">sessionFactory</span><span class="o">.</span><span class="na">createSession</span><span class="o">()).</span><span class="na">list</span><span class="o">();</span>
</pre></div>

<p>The dollar function can be used as many time as needed to access a property</p>

<div class="highlight highlight-java"><pre><span class="n">select</span><span class="o">(</span><span class="n">user</span><span class="o">).</span><span class="na">from</span><span class="o">(</span><span class="n">user</span><span class="o">)</span>
    <span class="o">.</span><span class="na">innerJoin</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getChildren</span><span class="o">())</span>
    <span class="o">.</span><span class="na">innerJoin</span><span class="o">(</span><span class="n">$</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getChildren</span><span class="o">()).</span><span class="na">getAdress</span><span class="o">())</span>
    <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">$</span><span class="o">(</span><span class="n">$</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getChildren</span><span class="o">()).</span><span class="na">getAdress</span><span class="o">()).</span><span class="na">getCity</span><span class="o">()).</span><span class="na">isLike</span><span class="o">(</span><span class="s">"F%"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">sessionFactory</span><span class="o">.</span><span class="na">createSession</span><span class="o">()).</span><span class="na">list</span><span class="o">();</span>
</pre></div>

<h1>
<a name="tips-and-advanced-usages" class="anchor" href="#tips-and-advanced-usages"><span class="octicon octicon-link"></span></a>Tips and advanced usages</h1>

<h2>
<a name="cross-join" class="anchor" href="#cross-join"><span class="octicon octicon-link"></span></a>Cross join</h2>

<p>To query on two distinct entities, it is necessary to build two proxies. 
Since the <code>queryOn</code> function can be called only once, you have to create the second proxy with the <code>andQueryOn</code> method.</p>

<div class="highlight highlight-java"><pre><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">queryOn</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">());</span>
<span class="n">Country</span> <span class="n">country</span> <span class="o">=</span> <span class="n">andQueryOn</span><span class="o">(</span><span class="k">new</span> <span class="n">Country</span><span class="o">());</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">usersWithACountryName</span> <span class="o">=</span> <span class="n">select</span><span class="o">(</span><span class="n">user</span><span class="o">).</span><span class="na">from</span><span class="o">(</span><span class="n">user</span><span class="o">).</span><span class="na">andFrom</span><span class="o">(</span><span class="n">country</span><span class="o">)</span>
                                    <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getLastName</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">country</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
                                    <span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">sessionFactory</span><span class="o">.</span><span class="na">createSession</span><span class="o">()).</span><span class="na">list</span><span class="o">();</span>
</pre></div>

<h2>
<a name="declare-variables" class="anchor" href="#declare-variables"><span class="octicon octicon-link"></span></a>Declare variables</h2>

<p>Accessing deep properties can make your query hard to read. With Yaqapi, you can declare a variable for whatever entity.</p>

<div class="highlight highlight-java"><pre><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">queryOn</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">());</span>
<span class="n">Adress</span> <span class="n">adress</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="na">getAdress</span><span class="o">();</span>
<span class="n">City</span> <span class="n">city</span> <span class="o">=</span> <span class="n">adress</span><span class="o">.</span><span class="na">getCity</span><span class="o">();</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">selectFrom</span><span class="o">(</span><span class="n">user</span><span class="o">).</span><span class="na">innerJoinFetch</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getAdress</span><span class="o">())</span>
                                    <span class="o">.</span><span class="na">innerJoinFetch</span><span class="o">(</span><span class="n">adress</span><span class="o">.</span><span class="na">getCity</span><span class="o">())</span>
                                    <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">city</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">isLike</span><span class="o">(</span><span class="s">"R%"</span><span class="o">)</span>
                                    <span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">sessionFactory</span><span class="o">.</span><span class="na">createSession</span><span class="o">()).</span><span class="na">list</span><span class="o">();</span>
</pre></div>

<p><strong>Warning</strong> : You can declare variables for entities object. Final properties must be accessed via their getter in the DSL (like <code>city.getName()</code> in the previous example)</p>

<h2>
<a name="use-all-hibernate-features" class="anchor" href="#use-all-hibernate-features"><span class="octicon octicon-link"></span></a>Use all Hibernate features</h2>

<p>Yaqapi is <strong>just</strong> a query builder. This means that once you have called the build() method, you get a pure Hibernate Query object.
So you can call setFirstResult(), setMaxResults(),... functions :</p>

<div class="highlight highlight-java"><pre><span class="n">Query</span> <span class="n">hibernateQuery</span> <span class="o">=</span> <span class="n">select</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getLastName</span><span class="o">()).</span><span class="na">as</span><span class="o">(</span><span class="s">"name"</span><span class="o">).</span><span class="na">and</span><span class="o">(</span><span class="n">count</span><span class="o">(</span><span class="s">"*"</span><span class="o">)).</span><span class="na">as</span><span class="o">(</span><span class="s">"members"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">user</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">groupBy</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getLastName</span><span class="o">())</span>
                        <span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">sessionFactory</span><span class="o">.</span><span class="na">createSession</span><span class="o">());</span>
<span class="n">hibernateQuery</span><span class="o">.</span><span class="na">setResultTransformer</span><span class="o">(</span><span class="k">new</span> <span class="n">AliasToBeanResultTransformer</span><span class="o">(</span><span class="n">WhateverClass</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
<span class="k">return</span> <span class="n">hibernateQuery</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
</pre></div>

<h1>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h1>

<p>YAQ API is distributed under Mozilla Public License v2.0 meaning you can use this library either in open source and proprietary project.</p>

<p>If you improve this project by adding functionnality or fixing a bug, you must share all your improvements.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/nhurel">nhurel</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>